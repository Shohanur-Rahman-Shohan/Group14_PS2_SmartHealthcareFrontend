<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Billing | Pharmacist</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style> body{font-family:'Poppins',sans-serif;} .glass{background:rgba(255,255,255,0.16);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.08);} </style>
</head>
<body class="bg-gradient-to-br from-emerald-600 to-sky-700 min-h-screen text-white">

  <nav class="glass fixed top-0 left-0 right-0 px-8 py-4 flex justify-between items-center z-40 shadow-lg">
    <div class="text-2xl font-bold">Pharmacist Panel</div>
    <div class="flex gap-6 font-medium">
      <a href="pharmacist-dashboard.html">Dashboard</a>
      <a href="patients.html">Patients</a>
      <a href="inventory.html">Inventory</a>
      <a href="billing.html" class="text-yellow-200">Billing</a>
      <a href="ai-insights.html">AI Insights</a>
      <a href="profile.html">Profile</a>
    </div>
  </nav>

  <main class="pt-28 px-10 pb-20 container mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-semibold">Billing & Insurance</h1>
      <div class="flex gap-3">
        <input id="billSearch" onkeyup="renderBills()" placeholder="Search invoice..." class="rounded-lg p-2 text-black" />
        <button onclick="openBillForm()" class="bg-emerald-400 text-black px-4 py-2 rounded-lg">+ New Invoice</button>
      </div>
    </div>

    <div class="glass p-6 rounded-2xl overflow-x-auto">
      <table class="w-full">
        <thead class="text-emerald-100/90 border-b border-white/20">
          <tr>
            <th class="py-2">Invoice ID</th><th>Patient</th><th>Amount</th><th>Payment</th><th>Status</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="billTable"></tbody>
      </table>
    </div>
  </main>

  <!-- Bill modal -->
  <div id="billModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
    <div class="glass p-6 rounded-2xl w-96 text-black">
      <h2 id="billTitle" class="text-xl font-semibold mb-4">New Invoice</h2>
      <input id="b_patient" placeholder="Patient name" class="w-full mb-3 p-2 rounded" />
      <input id="b_amount" type="number" placeholder="Amount" class="w-full mb-3 p-2 rounded"/>
      <select id="b_payment" class="w-full mb-3 p-2 rounded"><option>Cash</option><option>Bkash</option><option>Insurance</option></select>
      <select id="b_status" class="w-full mb-4 p-2 rounded"><option>Paid</option><option>Pending</option><option>Pending Insurance</option></select>
      <div class="flex justify-end gap-3">
        <button onclick="closeBillForm()" class="px-3 py-1 border rounded">Cancel</button>
        <button onclick="saveBill()" class="px-3 py-1 bg-emerald-500 rounded text-white">Save</button>
      </div>
    </div>
  </div>

  <script>
    let bills = JSON.parse(localStorage.getItem('ph_bills')||'[]');
    let editingBillId = null;
    function saveBills(){ localStorage.setItem('ph_bills', JSON.stringify(bills)); }

    function generateInvoiceId(){ return 'INV-'+Math.floor(Math.random()*90000+10000); }

    function renderBills(){
      const q=(document.getElementById('billSearch').value||'').toLowerCase();
      billTable.innerHTML='';
      bills.filter(b => b.id.toLowerCase().includes(q) || b.patient.toLowerCase().includes(q))
           .forEach(b=>{
        const tr=document.createElement('tr'); tr.className='border-b border-white/10 hover:bg-white/5';
        tr.innerHTML = `
          <td class="py-2">${b.id}</td>
          <td>${b.patient}</td>
          <td>‡ß≥ ${b.amount}</td>
          <td>${b.payment}</td>
          <td class="${b.status.toLowerCase().includes('paid')?'text-green-200': 'text-yellow-200'}">${b.status}</td>
          <td>
            <button class="text-emerald-200 mr-3" onclick='editBill("${b.id}")'>‚úè Edit</button>
            <button class="text-red-300" onclick='deleteBill("${b.id}")'>üóë Delete</button>
          </td>
        `;
        billTable.appendChild(tr);
      });
      localStorage.setItem('ph_bills', JSON.stringify(bills));
      window.dispatchEvent(new Event('storage'));
    }

    if(bills.length===0){
      bills = [
        { id:'INV-10001', patient:'Sadia Rahman', amount:850, payment:'Bkash', status:'Pending' },
        { id:'INV-10002', patient:'Mahmud Hasan', amount:1200, payment:'Cash', status:'Paid' }
      ]; saveBills();
    }

    function openBillForm(){ editingBillId=null; billTitle.innerText='New Invoice'; b_patient.value=''; b_amount.value=''; b_payment.value='Cash'; b_status.value='Pending'; billModal.classList.remove('hidden'); billModal.classList.add('flex'); }
    function closeBillForm(){ billModal.classList.add('hidden'); billModal.classList.remove('flex'); }

    function saveBill(){
      const patient = b_patient.value.trim(), amount = Number(b_amount.value||0), payment = b_payment.value, status = b_status.value;
      if(!patient || !amount){ alert('Patient and amount required'); return; }
      if(editingBillId){
        const idx=bills.findIndex(x=>x.id===editingBillId); bills[idx] = {...bills[idx], patient, amount, payment, status};
      } else { bills.push({ id: generateInvoiceId(), patient, amount, payment, status }); }
      saveBills(); renderBills(); closeBillForm();
    }

    function editBill(id){
      const b=bills.find(x=>x.id===id); if(!b) return;
      editingBillId=id; billTitle.innerText='Edit Invoice'; b_patient.value=b.patient; b_amount.value=b.amount; b_payment.value=b.payment; b_status.value=b.status;
      billModal.classList.remove('hidden'); billModal.classList.add('flex');
    }

    function deleteBill(id){
      if(confirm('Delete invoice?')){ bills = bills.filter(x=>x.id!==id); saveBills(); renderBills(); }
    }

    renderBills();
  </script>
</body>
</html>
